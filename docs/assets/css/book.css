/* Book Psychoanalytic Theme — base styles */
*, *::before, *::after { box-sizing: border-box; }
html { 
  -webkit-text-size-adjust: 100%; 
  text-size-adjust: 100%; 
  scroll-behavior: smooth; 
}
:root {
  --page-bg: #F4EFE6;           /* warm paper */
  --ink: #1B1F2A;               /* primary text (ink) */
  --secondary-ink: #2E3245;     /* headings */
  --muted: #5C6270;             /* secondary */
  --accent: #7A2E2E;            /* psychoanalytic accent (deep red) */
  --accent-2: #0F1A2B;          /* midnight blue */
  --link: #4B5BA9;              /* links */
  --paper-shadow: rgba(0,0,0,.06);
  --page-width: 72ch;
  --line: 1.65;
}
@media (prefers-color-scheme: dark) {
  :root {
    --page-bg: #0E121A;
    --ink: #E9E6DD;
    --secondary-ink: #F3EBDC;
    --muted: #A6AEC3;
    --accent: #C26161;
    --accent-2: #121521;
    --link: #A8B5FF;
    --paper-shadow: rgba(0,0,0,.35);
  }
}
/* User toggleable theme */
html.theme-dark { 
  --page-bg: #0E121A;
  --ink: #E9E6DD;
  --secondary-ink: #F3EBDC;
  --muted: #A6AEC3;
  --accent: #C26161;
  --accent-2: #121521;
  --link: #A8B5FF;
  --paper-shadow: rgba(0,0,0,.35);
  color-scheme: dark;
}
body {
  margin: 0;
  color: var(--ink);
  background: var(--page-bg) url("../img/paper_texture.png") repeat;
  font-family: "Literata", "Merriweather", Georgia, "Times New Roman", serif;
  line-height: var(--line);
  letter-spacing: .01em;
  -webkit-font-smoothing: antialiased;
  font-kerning: normal;
  hanging-punctuation: first last;
}
a { color: var(--link); text-decoration: none; }
a:hover { text-decoration: underline; }
img { max-width: 100%; height: auto; }
.muted { color: var(--muted); }
blockquote {
  margin: 0 0 1rem;
  padding-left: 1.25rem;
  border-left: 2px solid color-mix(in oklab, var(--accent), transparent 40%);
  font-style: italic;
  color: var(--muted);
}

/* Book container */
.book {
  max-width: calc(var(--page-width) + 40ch);
  margin: 0 auto;
  padding: 0 2rem 6rem;
  position: relative;
}
.book::before, .book::after {
  content: "";
  position: absolute;
  top: 0; bottom: 0;
  width: 12px;
  filter: blur(1px);
  background: repeating-linear-gradient(
    to bottom,
    rgba(0,0,0,.02) 0 2px,
    transparent 2px 4px
  );
  opacity: .4;
  pointer-events: none;
}
.book::before { left: 0; box-shadow: 12px 0 24px -12px var(--paper-shadow) inset; }
.book::after  { right: 0; box-shadow: -12px 0 24px -12px var(--paper-shadow) inset; }

/* Header / cover */
.header {
  max-width: var(--page-width);
  margin: 0 auto;
  padding: 3rem 0 2rem;
  position: relative;
}
.brand { font-family: "Playfair Display", "Garamond", serif; letter-spacing: .03em; }
.brand a { color: inherit; }
.header .brand { font-size: clamp(1.2rem, 1.6vw + .8rem, 1.8rem); font-weight: 600; }
.cover {
  max-width: var(--page-width);
  margin: 2rem auto 3rem;
  padding: 2.5rem 2rem;
  background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.35));
  border-radius: .5rem;
  box-shadow: 0 40px 60px -40px var(--paper-shadow), 0 1px 0 rgba(255,255,255,.35) inset;
  position: relative;
  overflow: hidden;
}
.cover h1 {
  margin: 0 0 .6rem;
  font-family: "Playfair Display", "Garamond", serif;
  font-weight: 400;
  font-size: clamp(1.8rem, 4.6vw + .8rem, 3.4rem);
  color: var(--secondary-ink);
}
.book h2,
.book h3,
.book h4 {
  font-family: "Playfair Display", "Garamond", serif;
}
.cover p.lead {
  margin: 0;
  font-size: clamp(1rem, .6vw + .9rem, 1.25rem);
  color: var(--muted);
}
.cover .inkblot {
  position: absolute;
  right: -6%;
  bottom: -8%;
  width: clamp(220px, 40vw, 520px);
  mix-blend-mode: multiply;
  opacity: .18;
  transform: rotate(-2deg);
  pointer-events: none;
}
html.theme-dark .cover .inkblot { opacity: .28; mix-blend-mode: lighten; }

/* TOC / nav */
.toc {
  max-width: var(--page-width);
  margin: 1.5rem auto 2.5rem;
  padding-left: 0;
  list-style: none;
  border-left: 3px solid rgba(0,0,0,.08);
}
.toc li { margin: .35rem 0; padding-left: 1rem; }
.toc a { text-decoration: none; }
.toc a .num { color: var(--muted); margin-right: .5rem; }

/* Chapters */
main { counter-reset: chapter; }
.chapter {
  display: grid;
  grid-template-columns: 1fr minmax(0, var(--page-width)) 24ch 1fr;
  gap: 0 1.5rem;
  margin: 3.2rem 0;
  position: relative;
  counter-increment: chapter;
}
.chapter > .content { grid-column: 2; }
.chapter > .sidenote { grid-column: 3; color: var(--muted); font-size: .9rem; }
.chapter > .sidenote p { margin: 0 0 .6rem; }
.chapter::before {
  content: "Глава " counter(chapter);
  position: absolute;
  left: calc(50% - var(--page-width)/2);
  top: -1.8rem;
  font: italic 500 .95rem/1.2 "Playfair Display", "Garamond", serif;
  color: var(--muted);
  opacity: .85;
}
.chapter h2 {
  font-family: "Playfair Display", "Garamond", serif;
  font-weight: 400;
  margin: 0 0 .6rem;
  font-size: clamp(1.25rem, 1.2vw + 1rem, 2rem);
  color: var(--secondary-ink);
}
.chapter p { margin: 0 0 1rem; }
.chapter ul { margin: 0 0 1rem 1.25rem; padding-left: 1.25rem; }
.chapter ul li { margin: 0 0 .5rem; }
.chapter p.lead::first-letter {
  initial-letter: 2;
  -webkit-initial-letter: 2;
  font-weight: 600;
  color: var(--accent);
}

/* Footnotes area */
.footnotes { 
  max-width: var(--page-width); 
  margin: 3rem auto 0; 
  border-top: 1px solid rgba(0,0,0,.08);
  padding-top: 1rem;
  color: var(--muted);
}
.footnotes ol { margin: 0; padding-left: 1.25rem; }
sup.fn-ref { font-size: .75em; vertical-align: super; }

/* Progress bar */
.progress {
  position: fixed;
  left: 0; top: 0; right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent) 0%, var(--link) 100%);
  transform: scaleX(var(--p, 0));
  transform-origin: 0 50%;
  z-index: 1000;
  opacity: .9;
}
@media (prefers-reduced-motion: reduce) {
  html { scroll-behavior: auto; }
  .progress { transition: none; }
}

/* Sticky prev/next */
.pager {
  max-width: var(--page-width);
  margin: 2.5rem auto 0;
  display: flex; justify-content: space-between; gap: 1rem;
}
.pager a {
  display: inline-block;
  padding: .6rem .9rem;
  border-radius: .35rem;
  background: rgba(0,0,0,.06);
  color: inherit;
  text-decoration: none;
}
html.theme-dark .pager a { background: rgba(255,255,255,.06); }

/* Top bar (theme & toc) */
.topbar {
  position: sticky; top: 0;
  backdrop-filter: blur(4px);
  background: color-mix(in oklab, var(--page-bg), transparent 20%);
  border-bottom: 1px solid rgba(0,0,0,.06);
  z-index: 900;
}
.topbar-inner {
  max-width: var(--page-width);
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: .6rem 0;
  gap: 1rem;
}
.topbar .toc {
  display: flex;
  flex-wrap: wrap;
  gap: .75rem 1rem;
  margin: 0;
  padding-left: 0;
  list-style: none;
  border-left: none;
}
.topbar .toc li { margin: 0; padding-left: 0; }
.topbar .toc a {
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  color: inherit;
  font-size: .9rem;
  text-decoration: none;
}
.topbar .toc a .num { color: var(--muted); font-variant-numeric: oldstyle-nums; }
.topbar .toc a:hover { text-decoration: underline; }
.btn {
  appearance: none; border: none; cursor: pointer;
  background: rgba(0,0,0,.06);
  padding: .4rem .7rem; border-radius: .35rem;
  font-family: inherit; color: inherit;
}
.btn:hover { filter: brightness(1.05); }
html.theme-dark .btn { background: rgba(255,255,255,.08); }

/* Responsive adjustments */
@media (max-width: 1024px) {
  .chapter { grid-template-columns: 1fr minmax(0, var(--page-width)) 1fr; }
  .chapter > .sidenote { grid-column: 2; margin: .5rem 0 0; }
}
@media print {
  .topbar, .progress, .pager { display: none; }
  body { background: #fff !important; color: #111 !important; }
  .book::before, .book::after { display: none; }
  a { color: #000; text-decoration: none; }
}